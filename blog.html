<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Nikki&#39;s Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Nikki&#39;s Blog Atom Feed"><title data-react-helmet="true">Blog | Nikki&#x27;s Blog</title><meta data-react-helmet="true" property="og:title" content="Blog | Nikki&#x27;s Blog"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="description" content="Blog"><meta data-react-helmet="true" property="og:description" content="Blog"><meta data-react-helmet="true" property="og:url" content="https://nikkon18.github.io//blog"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="blog_posts_list"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://nikkon18.github.io//blog"><link data-react-helmet="true" rel="alternate" href="https://nikkon18.github.io//blog" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://nikkon18.github.io//blog" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.9c11c536.css">
<link rel="preload" href="/assets/js/runtime~main.852293d6.js" as="script">
<link rel="preload" href="/assets/js/main.026a2937.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Nikki&#x27;s Blog</b></a><a class="navbar__item navbar__link" href="/docs/Supervised Machine Learning/Overview of Machine learning">Notes</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">🌜</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">🌞</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-list-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_a9qW thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_uKok margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Kvuv"><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/阅读日记8 块级作用域：var缺陷以及为什么要引入let和const">阅读日记8 块级作用域：var缺陷以及为什么要引入let和const</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/阅读日记7 调用栈：为什么js代码会出现栈溢出">阅读日记7 调用栈：为什么js代码会出现栈溢出</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/阅读日记6 变量提升：js代码是按顺序执行吗？">阅读日记6 变量提升：js代码是按顺序执行吗？</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/阅读日记5 浏览器的渲染流程">阅读日记5 浏览器的渲染流程</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/阅读日记4 从输入URL到页面展示，这中间发生了什么">阅读日记4 从输入URL到页面展示，这中间发生了什么</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/阅读笔记3 http请求流程">阅读笔记3 http请求流程</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/阅读日记2 tcp协议是如何工作的">阅读日记2 tcp协议是如何工作的</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/阅读日记1 chrome浏览器发展过程">阅读日记1 chrome浏览器发展过程</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/剑指offer树相关算法题">剑指offer树相关算法题</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/VueRouter">VueRouter</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/团队中的git操作">团队中的git操作</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/Vue组件化设计">Vue组件化设计</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/前端网络安全">前端网络安全</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/Webpack的使用">Webpack的使用</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/css基本布局">css基本布局</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/this指向问题">this指向问题</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/字符串的常用方法">字符串的常用方法</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/数组的常用方法">数组的常用方法</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/js数据类型相关">js数据类型相关</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/执行上下文与变量提升">执行上下文与变量提升</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/异步编程的解决方案">异步编程的解决方案</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/事件模型">事件模型</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/深拷贝与浅拷贝">深拷贝与浅拷贝</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/闭包">闭包</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/js数据结构">js数据结构</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/express的基本使用">express的基本使用</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/blog/阅读日记8 块级作用域：var缺陷以及为什么要引入let和const">阅读日记8 块级作用域：var缺陷以及为什么要引入let和const</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-05-13T00:00:00.000Z" itemprop="datePublished">May 13, 2022</time> · <!-- -->7 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link avatar__photo"><img class="image_o0gy" src="https://avatars.githubusercontent.com/u/59378631?s=400&amp;u=5c50f7a8cf81217122611fb72484a0288d90a739&amp;v=4" alt="Nikki"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Nikki</span></a></div><small class="avatar__subtitle" itemprop="description">a coder</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><strong>作用域</strong>是指在程序中定义变量的区域，该位置决定了变量的生命周期。通俗来说，作用域就是<strong>变量与函数的可访问范围</strong>，即作用域控制着变量的函数的可见性和生命周期。</p><p>ES6之前的作用域：</p><ul><li>全局作用域</li><li>函数作用域</li></ul><p>ES6新增：</p><ul><li>块级作用域</li></ul><p>简单来讲，如果一种语言支持块级作用域，那么其代码块内部定义的变量在代码块外部是访问不到的，并且等该代码块中的代码执行完成之后，代码块中定义的变量会被销毁。</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="没有块级作用域的坏处">没有块级作用域的坏处：<a class="hash-link" href="#没有块级作用域的坏处" title="Direct link to heading">​</a></h5><p>导致了函数中的变量无论是在哪里声明的，在编译阶段都会被提取到执行上下文的变量环境中，所以这些变量在整个函数体内部的任何地方都是能被访问的，这也就是<strong>变量提升</strong></p><h5 class="anchor anchorWithStickyNavbar_mojV" id="变量提升带来的问题">变量提升带来的问题：<a class="hash-link" href="#变量提升带来的问题" title="Direct link to heading">​</a></h5><p>1.变量容易在不被察觉的情况下被覆盖掉</p><p>2.本应销毁的变量没有被销毁（例子：for循环+var声明变量）</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="es6如何解决变量提升的问题">ES6如何解决变量提升的问题：<a class="hash-link" href="#es6如何解决变量提升的问题" title="Direct link to heading">​</a></h5><p>引入let和const关键字</p><p>两者区别：使用let关键字声明的变量是可以被改变的，而使用const声明的变量值是不可以被改变的</p><p>这两个关键字支持块级作用域，在编译阶段，js引擎并不会把块中通过let和const声明的变量存放到变量环境中，这也就意味着<strong>在块中通过let和const声明的变量，并不会提升到全函数可见</strong></p><h5 class="anchor anchorWithStickyNavbar_mojV" id="js是如何支持块级作用域的">js是如何支持块级作用域的？<a class="hash-link" href="#js是如何支持块级作用域的" title="Direct link to heading">​</a></h5><p>js引擎是通过变量环境实现函数级作用域的</p><div class="codeBlockContainer_I0IT language-js theme-code-block"><div class="codeBlockContent_wNvx js"><pre tabindex="0" class="prism-code language-js codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">foo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> b </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> b </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> c </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> d </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">d</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">foo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>以上代码的执行流程：</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="第一步编译并创建执行上下文">第一步，编译并创建执行上下文<a class="hash-link" href="#第一步编译并创建执行上下文" title="Direct link to heading">​</a></h5><p>以下是执行时foo函数的执行上下文</p><p><img src="https://static001.geekbang.org/resource/image/f9/67/f9f67f2f53437218baef9dc724bd4c67.png" alt="img"></p><p>通过上图，我们可以得出以下结论：</p><ul><li>函数内部通过 var 声明的变量，在编译阶段全都被存放到<strong>变量环境</strong>里面了。</li><li>通过 let 声明的变量，在编译阶段会被存放到<strong>词法环境</strong>（Lexical Environment）中。</li><li>在函数的<strong>作用域块内部</strong>，通过 let 声明的变量并<strong>没有</strong>被存放到词法环境中。</li></ul><h5 class="anchor anchorWithStickyNavbar_mojV" id="第二步继续执行代码">第二步，继续执行代码<a class="hash-link" href="#第二步继续执行代码" title="Direct link to heading">​</a></h5><p>当执行到代码块里面时，变量环境中 a 的值已经被设置成了 1，词法环境中 b 的值已经被设置成了 2，这时候函数的执行上下文就如下图所示：</p><p><img src="https://static001.geekbang.org/resource/image/7e/fa/7e0f7bc362e0dea21d27dc5fb08d06fa.png" alt="img"></p><p>在词法环境内部，维护了一个小型栈结构，栈底是函数最外层的变量，进入一个作用域块后，就会把该作用域块内部的变量压到栈顶；当作用域执行完成之后，该作用域的信息就会从栈顶弹出，这就是词法环境的结构。需要注意下，我这里所讲的变量是指通过 let 或者 const 声明的变量。</p><p>查找变量a的过程：先找词法环境，再找变量环境</p><p><img src="https://static001.geekbang.org/resource/image/06/08/06c06a756632acb12aa97b3be57bb908.png" alt="img"></p><p>当作用域块执行结束之后，其内部定义的变量就会从词法环境的栈顶弹出，最终执行上下文如下图所示：</p><p><img src="https://static001.geekbang.org/resource/image/d4/28/d4f99640d62feba4202aa072f6369d28.png" alt="img"></p><p>块级作用域是通过词法环境的栈结构来实现的，而变量提升是通过变量环境来实现，通过这两种的结合，js引擎就同时支持了变量提升和块级作用域了。</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="思考">思考<a class="hash-link" href="#思考" title="Direct link to heading">​</a></h5><p>以下代码的打印结果：</p><div class="codeBlockContainer_I0IT language-js theme-code-block"><div class="codeBlockContent_wNvx js"><pre tabindex="0" class="prism-code language-js codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> myname</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;极客时间&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">myname</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> myname</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;极客邦&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>结果：</p><p>VM6277:3 Uncaught ReferenceError: Cannot access &#x27;myname&#x27; before initialization</p><p>原因：</p><p>在块级作用域内，let声明的变量被提升，但变量只是创建被提升，初始化并没有被提升，在初始化之前使用变量，就会形成暂时性死区</p><p>拓展：</p><p>var的创建和初始化被提升，赋值不会被提升。</p><p>let的创建被提升，初始化和赋值不会被提升。</p><p>function的创建、初始化和赋值均会被提升。</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="变量提升和暂时性死区的区别">变量提升和暂时性死区的区别：<a class="hash-link" href="#变量提升和暂时性死区的区别" title="Direct link to heading">​</a></h4><p>变量提升：编译时把var声明的变量放到变量环境，进入块级作用域是不编译的，所以不存在变量提升</p><p>暂时性死区：在初始化前使用变量，会形成暂时性死区，用var声明的变量会在创建是就进行初始化undefined，而let和cont声明的变量初始化时会被置为uninitialized标志位，在没有执行到赋值行时便对其进行访问，就会报暂时性死区错误</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/js变量提升">js变量提升</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/blog/阅读日记7 调用栈：为什么js代码会出现栈溢出">阅读日记7 调用栈：为什么js代码会出现栈溢出</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-05-10T00:00:00.000Z" itemprop="datePublished">May 10, 2022</time> · <!-- -->5 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link avatar__photo"><img class="image_o0gy" src="https://avatars.githubusercontent.com/u/59378631?s=400&amp;u=5c50f7a8cf81217122611fb72484a0288d90a739&amp;v=4" alt="Nikki"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Nikki</span></a></div><small class="avatar__subtitle" itemprop="description">a coder</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><strong>执行上下文</strong>分三种：</p><ul><li>全局执行上下文</li><li>函数执行上下文</li><li>eval函数执行上下文</li></ul><p><strong>调用栈就是用来管理函数调用关系的一种数据结构</strong></p><p><strong>js引擎通过栈这种后进先出的数据结构来管理执行上下文</strong></p><p><img src="https://static001.geekbang.org/resource/image/5e/05/5e2bb65019053abfd5e7710e41d1b405.png" alt="img"></p><p>在执行上下文创建好后，js引擎会将执行上下文压入栈中，通常把这种用来管理执行上下文的栈称为<strong>执行上下文栈</strong>，又称<strong>调用栈</strong></p><h4 class="anchor anchorWithStickyNavbar_mojV" id="从一个例子看调用栈是如何工作的">从一个例子看调用栈是如何工作的？<a class="hash-link" href="#从一个例子看调用栈是如何工作的" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT language-js theme-code-block"><div class="codeBlockContent_wNvx js"><pre tabindex="0" class="prism-code language-js codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">b</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter">c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> b</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">addAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">b</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter">c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> d </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain">  a</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">result</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">addAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h5 class="anchor anchorWithStickyNavbar_mojV" id="第一步创建全局执行上下文并将其压入栈底">第一步，创建全局执行上下文，并将其压入栈底<a class="hash-link" href="#第一步创建全局执行上下文并将其压入栈底" title="Direct link to heading">​</a></h5><p><img src="https://static001.geekbang.org/resource/image/a5/1d/a5d7ec1f8f296412acc045835b85431d.png" alt="img"></p><p>全局执行上下文压入到调用栈后，js引擎便开始执行全局代码。首先会执行a=2的赋值操作，然后会将全局上下文变量环境中a的值设置为2，设置后如下图</p><p><img src="https://static001.geekbang.org/resource/image/1d/1d/1d50269dbc5b4c69f83662ecdd977b1d.png" alt="img"></p><h5 class="anchor anchorWithStickyNavbar_mojV" id="第二步调用addall函数">第二步，调用addAll函数。<a class="hash-link" href="#第二步调用addall函数" title="Direct link to heading">​</a></h5><p>调用该函数时，js引擎会编译该函数，并为其创建一个执行上下文，最后将该函数的执行上下文压入栈中，如下图</p><p><img src="https://static001.geekbang.org/resource/image/7d/52/7d6c4c45db4ef9b900678092e6c53652.png" alt="img"></p><p>创建完addAll函数的执行上下文，便进入了函数代码的执行阶段，先执行的是d=10的赋值操作，执行语句会将addAll函数执行上下文中的d由undefined变成了10.</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="第三步执行到add函数调用语句时同样会为其创建执行上下文并将其压入调用栈">第三步，执行到add函数调用语句时，同样会为其创建执行上下文，并将其压入调用栈<a class="hash-link" href="#第三步执行到add函数调用语句时同样会为其创建执行上下文并将其压入调用栈" title="Direct link to heading">​</a></h5><p><img src="https://static001.geekbang.org/resource/image/cc/37/ccfe41d906040031a7df1e4f1bce5837.png" alt="img"></p><p>当add函数返回时，该函数的执行上下文就会从栈顶弹出，并将result的值设置为add函数的返回值，也就是9，如下图所示</p><p><img src="https://static001.geekbang.org/resource/image/03/96/03ca801a5372f941bf17d6088fee0f96.png" alt="img"></p><p>紧接着 addAll 执行最后一个相加操作后并返回，addAll 的执行上下文也会从栈顶部弹出，此时调用栈中就只剩下全局上下文了。最终如下图所示：</p><p><img src="https://static001.geekbang.org/resource/image/d0/7b/d0ac1d6e77735338fa97cc9a3f6c717b.png" alt="img"></p><p>至此，整个 JavaScript 流程执行结束了。</p><p>从上面可知：<strong>调用栈是js引擎追踪函数执行的一个机制</strong>，当一次有多个函数被调用时，通过调用栈就能够追踪到哪个函数正在被执行以及各函数之间的调用关系</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="开发中如何利用好调用栈">开发中如何利用好调用栈？<a class="hash-link" href="#开发中如何利用好调用栈" title="Direct link to heading">​</a></h4><p>1.打开“开发者工具”，点击“Source”标签，选择 JavaScript 代码的页面，然后在第 3 行加上断点，并刷新页面。你可以看到执行到 add 函数时，执行流程就暂停了，这时可以通过右边“call stack”来查看当前的调用栈的情况，如下图：</p><p><img src="https://static001.geekbang.org/resource/image/c0/a2/c0d303a289a535b87a6c445ba7f34fa2.png" alt="img"></p><p>2.使用console.trace()来输出当前的函数调用关系，比如在示例代码中的 add 函数里面加上了 console.trace()</p><p><img src="https://static001.geekbang.org/resource/image/ab/ce/abfba06cd23a7704a6eb148cff443ece.png" alt="img"></p><h4 class="anchor anchorWithStickyNavbar_mojV" id="栈溢出问题究竟指的是什么">栈溢出问题究竟指的是什么？<a class="hash-link" href="#栈溢出问题究竟指的是什么" title="Direct link to heading">​</a></h4><p>调用栈是有大小的，但入栈的执行上下文超过一定数目，js引擎就会报错，我们把这种错误叫做栈溢出。特别是在写递归代码的时候，很容易发生栈溢出。</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="如何解决">如何解决？<a class="hash-link" href="#如何解决" title="Direct link to heading">​</a></h5><p>可以使用一些方法来避免或者解决栈溢出的问题，比如把递归调用的形式改造成其他形式，或者使用加入定时器的方法来把当前任务拆分为其他很多小任务。</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/js变量提升">js变量提升</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/blog/阅读日记6 变量提升：js代码是按顺序执行吗？">阅读日记6 变量提升：js代码是按顺序执行吗？</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-05-08T00:00:00.000Z" itemprop="datePublished">May 8, 2022</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link avatar__photo"><img class="image_o0gy" src="https://avatars.githubusercontent.com/u/59378631?s=400&amp;u=5c50f7a8cf81217122611fb72484a0288d90a739&amp;v=4" alt="Nikki"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Nikki</span></a></div><small class="avatar__subtitle" itemprop="description">a coder</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>1.在执行过程中，若使用了未声明的变量，那么js执行会报错</p><p>2.在一个变量定义之前使用它，不会出错，但是该变量的值为undefined，而不是定义时的值</p><p>3.在一个函数定义之前使用它，不会报错，且函数能正确执行</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="变量提升">变量提升<a class="hash-link" href="#变量提升" title="Direct link to heading">​</a></h4><p><strong>变量</strong></p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">var myname = &#x27;dym&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>相当于</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">var myname //声明</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">myname = &#x27;dym&#x27;//赋值</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><strong>函数</strong></p><p><img src="https://static001.geekbang.org/resource/image/61/77/611c09ab995b9b608d9c0db193266777.png" alt="img"></p><p>所谓的<strong>变量提升</strong>，是指在 JavaScript 代码执行过程中，JavaScript 引擎把变量的声明部分和函数的声明部分提升到代码开头的“行为”。变量被提升后，会给变量设置默认值，这个默认值就是我们熟悉的 undefined。</p><p><img src="https://static001.geekbang.org/resource/image/ce/d5/cefe564dbff729e735a834fd9e3bd0d5.png" alt="img"></p><h4 class="anchor anchorWithStickyNavbar_mojV" id="js代码执行流程">js代码执行流程<a class="hash-link" href="#js代码执行流程" title="Direct link to heading">​</a></h4><p><img src="https://static001.geekbang.org/resource/image/64/1e/649c6e3b5509ffd40e13ce9c91b3d91e.png" alt="img"></p><h5 class="anchor anchorWithStickyNavbar_mojV" id="1编译阶段">1.编译阶段<a class="hash-link" href="#1编译阶段" title="Direct link to heading">​</a></h5><p><img src="https://static001.geekbang.org/resource/image/06/13/0655d18ec347a95dfbf843969a921a13.png" alt="img"></p><p>编译后代码会生成两部分：<strong>执行上下文</strong>和<strong>可执行代码</strong></p><p><strong>执行上下文</strong>是 JavaScript 执行一段代码时的运行环境，比如调用一个函数，就会进入这个函数的执行上下文，确定该函数在执行期间用到的诸如 this、变量、对象以及函数等。</p><p>会将变量和函数的声明存放到变量环境中，若存在重复的变量或函数，第二个变量或函数会覆盖前一个</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="2执行阶段">2.执行阶段<a class="hash-link" href="#2执行阶段" title="Direct link to heading">​</a></h5><p>js引擎开始执行可执行代码，按照顺序一行一行地执行。当执行到对应地变量和函数时，js引擎便开始在变量环境对象中查找该函数。</p><p>一段代码如果定义了两个相同名字的函数，那么最终生效的是最后一个函数</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/js变量提升">js变量提升</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/blog/阅读日记5 浏览器的渲染流程">阅读日记5 浏览器的渲染流程</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-05-06T00:00:00.000Z" itemprop="datePublished">May 6, 2022</time> · <!-- -->7 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link avatar__photo"><img class="image_o0gy" src="https://avatars.githubusercontent.com/u/59378631?s=400&amp;u=5c50f7a8cf81217122611fb72484a0288d90a739&amp;v=4" alt="Nikki"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Nikki</span></a></div><small class="avatar__subtitle" itemprop="description">a coder</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>渲染模块的处理流程叫<strong>渲染流水线</strong>，大致流程如下：</p><p>构建DOM树、样式计算、布局阶段、分层、绘制、分块、光栅化和合成</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="构建dom树">构建DOM树<a class="hash-link" href="#构建dom树" title="Direct link to heading">​</a></h5><p>将HTML文件经过HTML解析器解析，最终输出树状结构的DOM，通过js可以操作dom</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="样式计算">样式计算<a class="hash-link" href="#样式计算" title="Direct link to heading">​</a></h5><p>目的是为了计算出DOM节点中每个元素的具体样式</p><ol><li>把css转换为浏览器能够理解的结构----styleSheets</li><li>转换样式表中的属性值，使其标准化</li><li>计算出DOM树中每个节点的具体样式（考虑继承规则和层叠规则）</li></ol><h5 class="anchor anchorWithStickyNavbar_mojV" id="布局阶段">布局阶段<a class="hash-link" href="#布局阶段" title="Direct link to heading">​</a></h5><p>布局指的是计算出DOM树中可见元素的几何位置的过程</p><ol><li>创建只包含可见元素的布局树</li><li>布局计算</li></ol><p><strong>以上阶段总结：</strong></p><p>在 HTML 页面内容被提交给渲染引擎之后，渲染引擎首先将 HTML 解析为浏览器可以理解的 DOM；然后根据 CSS 样式表，计算出 DOM 树所有节点的样式；接着又计算每个元素的几何坐标位置，并将这些信息保存在布局树中。</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="分层">分层<a class="hash-link" href="#分层" title="Direct link to heading">​</a></h5><p>为了方便实现3D变换、页面滚动等效果，渲染引擎还需要为特定的节点生成专用的图层，并生成一颗对应的图层树（LayerTree）。</p><p>浏览器的页面实际上被分成了很多图层，这些图层叠加后合成了最终的页面</p><p><img src="https://static001.geekbang.org/resource/image/e8/61/e8a7e60a2a08e05239456284d2aa4061.png" alt="img"></p><p>为新节点创建新图层的条件：</p><ul><li><p>拥有层叠上下文属性的元素会被提升为单独一层</p><p>层叠上下文指的是HTML元素按照自身属性的优先级分布在垂直于这个二维平面的z轴上</p><p><img src="https://static001.geekbang.org/resource/image/a0/19/a03eb12053aac1ac496b61a424f20119.png" alt="img"></p><p>拥有明确定位属性的元素，定义透明属性的元素，使用css滤镜的元素等，都拥有层叠上下文属性</p></li><li><p>需要裁剪的地方也会被创建为图层</p></li></ul><h5 class="anchor anchorWithStickyNavbar_mojV" id="图层绘制">图层绘制<a class="hash-link" href="#图层绘制" title="Direct link to heading">​</a></h5><p>渲染引擎会把一个图层的绘制拆分成很多很小的绘制指令，然后再把这些指令按照顺序组成一个待绘制列表</p><p><img src="https://static001.geekbang.org/resource/image/40/08/40825a55214a7990bba6b9bec6e54108.png" alt="img"></p><h5 class="anchor anchorWithStickyNavbar_mojV" id="栅格化操作">栅格化操作<a class="hash-link" href="#栅格化操作" title="Direct link to heading">​</a></h5><p>实际上的绘制操作是由渲染引擎中的合成线程完成的，当图层的绘制列表准备好之后，主线程会把该绘制列表<strong>提交</strong>给合成线程</p><p>合成线程会将图层划分为图块，大小通常是256x256或者512x512</p><p><img src="https://static001.geekbang.org/resource/image/bc/52/bcc7f6983d5ece8e2dd716f431d0e052.png" alt="img"></p><p>合成线程会按照视口附近的图块来优先生成位图，实际生成位图的操作是由栅格化来执行的。<strong>所谓栅格化，是将图块转换为位图</strong>。</p><p>渲染进程维护了一个栅格化的线程池，所有的图块栅格化都是在线程池内执行的</p><p>通常，栅格化过程都会使用 GPU 来加速生成，使用 GPU 生成位图的过程叫快速栅格化，或者 GPU 栅格化，生成的位图被保存在 GPU 内存中。</p><p><img src="https://static001.geekbang.org/resource/image/a8/87/a8d954cd8e4722ee03d14afaa14c3987.png" alt="img"></p><h5 class="anchor anchorWithStickyNavbar_mojV" id="合成与显示">合成与显示<a class="hash-link" href="#合成与显示" title="Direct link to heading">​</a></h5><p>一旦所有图块都被光栅化，合成线程就会生成一个绘制图块的命令——“DrawQuad”，然后将该命令提交给浏览器进程。</p><p>浏览器进程里面有一个叫 viz 的组件，用来接收合成线程发过来的 DrawQuad 命令，然后根据 DrawQuad 命令，将其页面内容绘制到内存中，最后再将内存显示在屏幕上。</p><p>整个渲染的流水线：</p><p><img src="https://static001.geekbang.org/resource/image/97/37/975fcbf7f83cc20d216f3d68a85d0f37.png" alt="img"></p><p>以上的总结，一个完整的渲染流程如下：</p><ol><li>渲染进程将 HTML 内容转换为能够读懂的 <strong>DOM 树</strong>结构。</li><li>渲染引擎将 CSS 样式表转化为浏览器可以理解的 <strong>styleSheets</strong>，计算出 DOM 节点的样式。</li><li>创建<strong>布局树</strong>，并计算元素的布局信息。</li><li>对布局树进行分层，并生成<strong>分层树</strong>。</li><li>为每个图层生成<strong>绘制列表</strong>，并将其提交到合成线程。</li><li>合成线程将图层分成<strong>图块</strong>，并在<strong>光栅化线程池</strong>中将图块转换成位图。</li><li>合成线程发送绘制图块命令 <strong>DrawQuad</strong> 给浏览器进程。</li><li>浏览器进程根据 DrawQuad 消息<strong>生成页面</strong>，并<strong>显示</strong>到显示器上。</li></ol><h5 class="anchor anchorWithStickyNavbar_mojV" id="再思考三个常见的概念">再思考三个常见的概念：<a class="hash-link" href="#再思考三个常见的概念" title="Direct link to heading">​</a></h5><p><strong>重排、重绘、合成</strong></p><h5 class="anchor anchorWithStickyNavbar_mojV" id="1重排更新了元素的几何属性宽度高度等">1.重排：更新了元素的几何属性（宽度高度等）<a class="hash-link" href="#1重排更新了元素的几何属性宽度高度等" title="Direct link to heading">​</a></h5><p>浏览器会触发重新布局，解析之后的一系列子阶段</p><p><img src="https://static001.geekbang.org/resource/image/b3/e5/b3ed565230fe4f5c1886304a8ff754e5.png" alt="img"></p><h5 class="anchor anchorWithStickyNavbar_mojV" id="2重绘更新元素的绘制属性背景颜色等">2.重绘：更新元素的绘制属性（背景颜色等）<a class="hash-link" href="#2重绘更新元素的绘制属性背景颜色等" title="Direct link to heading">​</a></h5><p>布局阶段将不会被执行，因为并没有引起几何位置的变换，所以就直接进入了绘制阶段，然后执行之后的一系列子阶段</p><p><img src="https://static001.geekbang.org/resource/image/3c/03/3c1b7310648cccbf6aa4a42ad0202b03.png" alt="img"></p><h5 class="anchor anchorWithStickyNavbar_mojV" id="3合成更改一个既不要布局也不要绘制的属性使用transform实现动画效果">3.合成：更改一个既不要布局也不要绘制的属性（使用transform实现动画效果）<a class="hash-link" href="#3合成更改一个既不要布局也不要绘制的属性使用transform实现动画效果" title="Direct link to heading">​</a></h5><p>渲染引擎将跳过布局和绘制，只执行后续的合成操作</p><p>一些Q&amp;A：</p><p>减少重绘重排的方法：</p><ol><li>使用 class 操作样式，而不是频繁操作 style </li><li>避免使用 table 布局 </li><li>批量dom 操作，例如 createDocumentFragment，或者使用框架，例如 React </li><li>Debounce window resize 事件 </li><li>对 dom 属性的读写要分离  </li><li>will-change: transform 做优化</li></ol></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/浏览器">浏览器</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/blog/阅读日记4 从输入URL到页面展示，这中间发生了什么">阅读日记4 从输入URL到页面展示，这中间发生了什么</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-05-04T00:00:00.000Z" itemprop="datePublished">May 4, 2022</time> · <!-- -->7 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link avatar__photo"><img class="image_o0gy" src="https://avatars.githubusercontent.com/u/59378631?s=400&amp;u=5c50f7a8cf81217122611fb72484a0288d90a739&amp;v=4" alt="Nikki"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Nikki</span></a></div><small class="avatar__subtitle" itemprop="description">a coder</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><img src="https://static001.geekbang.org/resource/image/92/5d/92d73c75308e50d5c06ad44612bcb45d.png" alt="img"></p><p>从输入URL到页面展示的过程中，需要各个进程之间的配合</p><ul><li>浏览器进程主要负责用户交互、子进程管理和文件储存等功能</li><li>网络进程是面向渲染进程和浏览器进程等提供网络下载功能</li><li>渲染进程的主要职责是把从网络下载的html、js、css、图片等资源解析为可以显示和交互的页面。出于安全考虑，Chrome让渲染进程运行在安全沙箱里。</li></ul><h5 class="anchor anchorWithStickyNavbar_mojV" id="1用户输入">1.用户输入<a class="hash-link" href="#1用户输入" title="Direct link to heading">​</a></h5><p>地址栏 会判断输入关键字是搜索内容，还是请求url</p><p>在页面替换之前，当前页面还会执行一次beforeunload事件，它允许页面在退出之前执行一些数据清理操作</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="2url请求过程">2.URL请求过程<a class="hash-link" href="#2url请求过程" title="Direct link to heading">​</a></h5><p>浏览器进程会通过IPC把URL请求发送至网络进程，网络进程接收到URL请求后，会在这里发起真正的URL请求流程。</p><p>请求流程：</p><ul><li><p>检查缓存</p><ul><li><p>有缓存，返回资源给浏览器进程</p></li><li><p>没有缓存，进行DNS解析（获取请求域名的服务器IP地址），若请求协议是HTTPS，还需要建立TLS连接，接下来就是利用IP地址和服务器建立TCP连接。连接建立后，浏览器会构建请求行，请求头等信息发送给服务器；服务器收到请求后，会根据请求信息生成响应数据，发送给网络进程。网络进程收到后，开始解析响应头。若状态码是301或者302，会读取location里的地址，重新发起http请求</p></li></ul></li></ul><h5 class="anchor anchorWithStickyNavbar_mojV" id="3准备渲染进程">3.准备渲染进程<a class="hash-link" href="#3准备渲染进程" title="Direct link to heading">​</a></h5><p>总结来说，打开一个新页面采用的渲染进程策略就是：</p><ul><li>通常情况下，打开新的页面都会使用单独的渲染进程；</li><li>如果从 A 页面打开 B 页面，且 A 和 B 都属于同一站点的话，那么 B 页面复用 A 页面的渲染进程；如果是其他情况，浏览器进程则会为 B 创建一个新的渲染进程。</li></ul><h5 class="anchor anchorWithStickyNavbar_mojV" id="4提交文档">4.提交文档<a class="hash-link" href="#4提交文档" title="Direct link to heading">​</a></h5><p>提交文档指的是浏览器进程将网络进程接收到的HTML数据交给渲染进程，流程如下</p><ul><li><p>浏览器进程接收到网络进程的响应头数据后，便向渲染进程发起“提交文档”的消息</p></li><li><p>渲染进程接收到“提交文档”的消息后，会和网络进程建立传输数据的管道</p></li><li><p>等文档数据传输完成之后，渲染进程会返回“确认提交”的消息给浏览器进程</p></li><li><p>浏览器进程在收到“确认提交”的消息后，会更新浏览器界面状态</p><p>更新内容如下</p><p><img src="https://static001.geekbang.org/resource/image/d3/b8/d3c5a6188b09b5b57af439005ae7dfb8.png" alt="img"></p></li></ul><h5 class="anchor anchorWithStickyNavbar_mojV" id="5渲染阶段">5.渲染阶段<a class="hash-link" href="#5渲染阶段" title="Direct link to heading">​</a></h5><p>一旦文档被提交，渲染进程便开始页面解析和子资源加载了，而一旦渲染完毕，渲染进程会发送一个消息给浏览器进程，浏览器接收到这个消息后会停止标签图标的加载动画</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="一个简单的总结">一个简单的总结：<a class="hash-link" href="#一个简单的总结" title="Direct link to heading">​</a></h5><p>1，用户输入url并回车   </p><p>2，浏览器进程检查url，组装协议，构成完整的url    </p><p>3，浏览器进程通过进程间通信（IPC）把url请求发送给网络进程  4，网络进程接收到url请求后检查本地缓存是否缓存了该请求资源，如果有则将该资源返回给浏览器进程    </p><p>5，如果没有，网络进程向web服务器发起http请求（网络请求），请求流程如下：        </p><p>​	5.1 进行DNS解析，获取服务器ip地址，端口（端口是通过dns解析获取的吗？这里有个疑问）        </p><p>​	5.2 利用ip地址和服务器建立tcp连接        </p><p>​	5.3 构建请求头信息        </p><p>​	5.4 发送请求头信息       </p><p>​	5.5 服务器响应后，网络进程接收响应头和响应信息，并解析响应内容    </p><p>6，网络进程解析响应流程；        </p><p>​	6.1 检查状态码，如果是301/302，则需要重定向，从Location自动中读取地址，重新进行第4步 （301/302跳转也会读取本地缓存吗？这里有个疑问），如果是200，则继续处理请求。        </p><p>​	6.2 200响应处理：检查响应类型Content-Type，如果是字节流类型，则将该请求提交给下载管理器，该导航流程结束，不再进行            后续的渲染，如果是html则通知浏览器进程准备渲染进程准备进行渲染。    </p><p>7，准备渲染进程        </p><p>​	7.1 浏览器进程检查当前url是否和之前打开的渲染进程根域名是否相同，如果相同，则复用原来的进程，如果不同，则开启新的渲染进程    </p><p>8，传输数据、更新状态       </p><p>​	8.1 渲染进程准备好后，浏览器向渲染进程发起“提交文档”的消息，渲染进程接收到消息和网络进程建立传输数据的“管道”        </p><p>​	8.2 渲染进程接收完数据后，向浏览器发送“确认提交”        </p><p>​	8.3 浏览器进程接收到确认消息后更新浏览器界面状态：安全、地址栏url、前进后退的历史状态、更新web页面。</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/http">http</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/blog/阅读笔记3 http请求流程">阅读笔记3 http请求流程</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-04-29T00:00:00.000Z" itemprop="datePublished">April 29, 2022</time> · <!-- -->11 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link avatar__photo"><img class="image_o0gy" src="https://avatars.githubusercontent.com/u/59378631?s=400&amp;u=5c50f7a8cf81217122611fb72484a0288d90a739&amp;v=4" alt="Nikki"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Nikki</span></a></div><small class="avatar__subtitle" itemprop="description">a coder</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>回顾上文知识：</p><p>一个TCP连接过程包括了建立连接，传输数据，断开连接三个阶段。</p><p>HTTP协议正是建立在TCP连接基础之上的，它是一种允许浏览器向服务器获取资源的协议，是Web的基础。</p><p>带着问题阅读：</p><p>1.为什么通常在第一次访问一个站点时，打开速度很慢，当再次访问这个站点时，速度就很快了？</p><p>2.当登录过一个网站之后，下次再访问该站点，就已经处于登录状态了，这是怎么做到的呢？</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="浏览器发起http请求流程"><strong>浏览器发起HTTP请求流程</strong><a class="hash-link" href="#浏览器发起http请求流程" title="Direct link to heading">​</a></h4><p><strong>1.构建请求</strong></p><p>浏览器构建请求行信息（如下）</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">GET /index.html HTTP1.1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><strong>2.查找缓存</strong></p><p>在真正发起网络请求之前，浏览器会先在浏览器缓存中查询是否有要请求的文件。</p><p>当浏览器发现请求的资源已经在浏览器缓存中存有副本，它会拦截请求，返回该资源的副本，并直接结束请求，而不会再去源服务器重新下载。</p><p>如果缓存查找失败，就会进入网络请求过程了</p><p><strong>3.准备IP地址和端口</strong></p><p>HTTP的内容是通过TCP的传输数据阶段实现的</p><p><img src="https://static001.geekbang.org/resource/image/12/80/1277f342174b23f9442d3b27016d7980.png" alt="img"></p><p>而建立TCP连接的第一步就是获取对应的IP地址和端口号</p><p>IP地址：通过<strong>DNS域名解析系统</strong>（拿到url中的域名解析出IP地址）获取，如果存在DNS缓存的话，可以直接从缓存中拿</p><p>端口号：如果url没有特别指明端口号，那http协议默认是80端口，https默认443端口</p><p><strong>4.等待TCP队列</strong></p><p>chrome有个机制，同一个域名同时最多只能建立6个TCP连接，如果在同一个域名下同时有10个请求发生，那么其中4个请求会进入排队等待状态，直至进行中的请求完成</p><p><strong>5.建立TCP连接</strong></p><p>排队等待结束之后，开始建立TCP连接</p><p><strong>6.发送HTTP请求</strong></p><p>先发送请求行，再发送请求头和请求体（只发送一次）</p><ul><li>Host：当前请求的主机域名信息</li><li>Connection：keep-alive 告诉服务器保持长连接，避免重复三次握手建立tcp连接</li><li>Accept-Language：浏览器可以读取的语言</li><li>Accept-Encodeing：浏览器可以支持的压缩方式</li><li>Accept:浏览器支持的资源文件类型，如text/html</li><li>Cookie:浏览器端的Cookie信息</li><li>Cache-Control:浏览器端的缓存策略是强缓存</li><li>User-Agent:浏览器内核和操作系统等信息</li></ul><p><img src="https://static001.geekbang.org/resource/image/b8/d7/b8993c73f7b60feb9b8bd147545c47d7.png" alt="img"></p><p><strong>7.服务器处理HTTP请求</strong></p><p>先返回响应行，再返回响应头，再返回响应体</p><p><img src="https://static001.geekbang.org/resource/image/3e/76/3e30476a4bbda49fd7cd4fd0ea09f076.png" alt="img"></p><p><strong>8.断开TCP连接</strong></p><p>通常情况下，一旦服务器向客户端返回了请求数据，它就要关闭 TCP 连接。不过如果浏览器或者服务器在其头信息中加入了：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">Connection:Keep-Alive</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>那么 TCP 连接在发送后将仍然保持打开状态，这样浏览器就可以继续通过同一个 TCP 连接发送请求。<strong>保持 TCP 连接可以省去下次请求时需要建立连接的时间，提升资源加载速度。</strong></p><p>考虑一种情况：</p><p>当我们在浏览器中打开geekbang.org时，打开的网址却是<a href="https://www.geekbang.org/%EF%BC%8C%E8%BF%99%E4%B8%A4%E4%B8%AAurl%E4%B8%8D%E4%B8%80%E6%A0%B7%E7%9A%84%E5%8E%9F%E5%9B%A0%E6%98%AF%EF%BC%8C%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%81%9A%E4%BA%86%E4%B8%80%E4%B8%AA**%E9%87%8D%E5%AE%9A%E5%90%91**%E6%93%8D%E4%BD%9C%EF%BC%8C%E5%BD%93%E6%88%91%E4%BB%AC%E8%AF%B7%E6%B1%82geekbang.org%E6%97%B6%EF%BC%8C%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BC%9A%E8%BF%94%E5%9B%9E%E7%8A%B6%E6%80%81%E7%A0%81301%E5%92%8C%E9%87%8D%E5%AE%9A%E5%90%91%E7%9A%84%E5%9C%B0%E5%9D%80%EF%BC%8C%E6%8E%A5%E4%B8%8B%E6%9D%A5%EF%BC%8C%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B0%B1%E4%BC%9A%E8%8E%B7%E5%8F%96location%E5%AD%97%E6%AE%B5%E4%B8%AD%E7%9A%84%E5%9C%B0%E5%9D%80%EF%BC%8C%E5%B9%B6%E4%BD%BF%E7%94%A8%E8%AF%A5%E5%9C%B0%E5%9D%80%E9%87%8D%E6%96%B0%E5%AF%BC%E8%88%AA" target="_blank" rel="noopener noreferrer">https://www.geekbang.org/，这两个url不一样的原因是，服务器做了一个**重定向**操作，当我们请求geekbang.org时，服务器会返回状态码301和重定向的地址，接下来，浏览器就会获取location字段中的地址，并使用该地址重新导航</a></p><p><img src="https://static001.geekbang.org/resource/image/28/43/28d5796c6ab7faa619ed8f1bd17b0843.jpg" alt="img"></p><p>现在，思考刚刚提出的问题：</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="1为什么很多站点第二次打开速度会很快">1.为什么很多站点第二次打开速度会很快？<a class="hash-link" href="#1为什么很多站点第二次打开速度会很快" title="Direct link to heading">​</a></h5><p>因为第一次加载过程中，进行了<strong>DNS缓存</strong>和<strong>页面资源缓存</strong></p><p>页面资源缓存处理过程：</p><p><img src="https://static001.geekbang.org/resource/image/5f/08/5fc2f88a04ee0fc41a808f3481287408.png" alt="img"></p><p>服务器通过控制响应头中的Cache-Control字段来设置是否缓存该资源，通常还会设置一个Max-Age参数来控制过期时长</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">//过期时长为2000秒</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Cache-Control:Max-age=2000</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>在缓存资源还未过期时，再次请求该资源，会直接返回缓存中的资源给浏览器</p><p>如果过期了，浏览器会继续发起网络请求，并且在HTTP请求头中带上</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">If-None-Match:&quot;4f80f-13c-3a1xb12a&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>服务器根据If-None-Match的值来判断请求的资源是否有更新</p><ul><li>没有更新，返回304状态码，使用浏览器缓存</li><li>有更新，返回200状态码和全新资源</li></ul><h5 class="anchor anchorWithStickyNavbar_mojV" id="2登录状态如何保持">2.登录状态如何保持？<a class="hash-link" href="#2登录状态如何保持" title="Direct link to heading">​</a></h5><ul><li><p>用户输入用户名密码，点击确定按钮，会调用POST方法提交用户登录信息给服务器</p></li><li><p>服务器收到信息后验证信息是否正确，正确的话，会生成一段表示用户身份的字符串，并且把这个字符串写到响应头的Set-Cookie字段里面，把响应头发送给浏览器</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">Set-Cookie: UID=3431uad;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>浏览器接收到服务器的响应头后，开始解析响应头，如果遇到响应头里含有Set-Cookie字段的情况，浏览器就会把这个字段信息保存到本地</p></li><li><p>当用户再次访问时，浏览器会发起HTTP请求，但在发起请求之前，浏览器会读取之前保存的cookie数据，并把数据写进请求头的Cookie字段里，然后浏览器再将请求头发送给浏览器</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">Cookie: UID=3431uad;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>服务器在收到 HTTP 请求头数据之后，就会查找请求头里面的“Cookie”字段信息，当查找到包含UID=3431uad的信息时，服务器查询后台，并判断该用户是已登录状态，然后生成含有该用户信息的页面数据，并把生成的数据发送给浏览器。</p></li><li><p>浏览器在接收到该含有当前用户的页面数据后，就可以正确展示用户登录的状态信息了。</p><p><img src="https://static001.geekbang.org/resource/image/d9/b3/d9d6cefe8d3d6d84a37a626687c6ecb3.png" alt="img"></p></li></ul><p>以上是cookie流程图</p><p>简单描述：</p><p>如果服务器端发送的响应头内有 Set-Cookie 的字段，那么浏览器就会将该字段的内容保持到本地。当下次客户端再往该服务器发送请求时，客户端会自动在请求头中加入 Cookie 值后再发送出去。服务器端发现客户端发送过来的 Cookie 后，会去检查究竟是从哪一个客户端发来的连接请求，然后对比服务器上的记录，最后得到该用户的状态信息。</p><p><img src="https://static001.geekbang.org/resource/image/1b/6c/1b49976aca2c700883d48d927f48986c.png" alt="img"></p><p>一些疑问：</p><p>1.浏览器刷新操作，ctrl+F5和F5有什么区别？</p><p>普通刷新页面，会走正常的缓存流程，比如强缓存和协商缓存。而强制刷新会跳过强缓存和协商缓存的过程，http 请求会缺少 if-none-match 字段，直接请求服务器重新拉取资源</p><p>2.一个域名下一次只能建立6个tcp连接是什么意思？</p><p>是同一个域名下面，同一时间只能有6个并发请求，超过六个以上的需要排队！</p><p>3.如果一个页面的网络加载时间过久，你是如何分析卡在哪个阶段的？</p><p>最好的方法是基于Network面板下的Timing来来进行分析。
Timing表示该请求的时间线轴线：</p><ol><li><p>Quened at 36.01ms
代表发送请求前的排队所消耗时间为36.01ms
有可能是前面有正在发送的请求
有可能是有的请求优先级比较高所以排队（network中有Priority选项代表请求的优先级）</p><p>Started at 36.01ms
正式开启请求时间</p></li><li><p>Connection Start 开始连接
Stalled tcp链接复用 处理代理相关的逻辑所等待的时间
DNS Lookup DNS域名解析消耗的时间
Initial connection 创建TCP连接所消耗的时间
SSL HTTPS请求进行SSL协商消耗的时间</p></li><li><p>Request/Response 请求响应阶段
Request sent 发送请求的时间 很短 没法优化
Waiting（TTFB）从发起请求到服务器返回首字节时间（可优化点：请求发出到响应总时长）
Content Download 服务器返回的资源下载所需时间（可优化点：返回资源的大小会影响时间）</p></li></ol></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/http">http</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/blog/阅读日记2 tcp协议是如何工作的">阅读日记2 tcp协议是如何工作的</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-04-25T00:00:00.000Z" itemprop="datePublished">April 25, 2022</time> · <!-- -->6 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link avatar__photo"><img class="image_o0gy" src="https://avatars.githubusercontent.com/u/59378631?s=400&amp;u=5c50f7a8cf81217122611fb72484a0288d90a739&amp;v=4" alt="Nikki"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Nikki</span></a></div><small class="avatar__subtitle" itemprop="description">a coder</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>衡量web页面性能的重要指标：<strong>FP</strong>（First Paint），指从页面加载到首次开始绘制的时长；</p><p>影响FP的重要因素：<strong>网络加载速度</strong></p><p>在网络中，不管是使用HTTP还是WebSocket，他们都是基于<strong>TCP/IP</strong></p><h4 class="anchor anchorWithStickyNavbar_mojV" id="web世界中的tcpip是如何工作的">Web世界中的TCP/IP是如何工作的？<a class="hash-link" href="#web世界中的tcpip是如何工作的" title="Direct link to heading">​</a></h4><p>如何保证页面文件能被完整地送达浏览器？</p><p>数据包的旅程：数据包-----&gt;主机-----&gt;应用</p><p><strong>1.IP：把数据包送达目的主机</strong></p><p>数据包要在互联网上进行传输，就要符合网际协议（<strong>IP</strong>）标准。</p><p>计算机的地址就称为<strong>IP地址</strong>，访问任何网站实际上只是你的计算机向另外一台计算机 请求信息。</p><p>每个IP数据包都有IP头，包括IP版本，源IP地址，目标IP地址，生存时间等信息</p><p><img src="https://static001.geekbang.org/resource/image/00/4d/00d9bcad0bda1fdb43ead428e89ae74d.png" alt="img"></p><p><strong>2.UDP：把数据包送达应用程序</strong></p><p>IP只负责把数据包传送到对方主机，但主机并不知道要把数据包交给哪个程序，因此，这时就需要基于IP之上开发能和应用打交道的协议，最常见的是”用户数据包协议“，简称<strong>UDP</strong></p><p>UDP中最重要的信息是<strong>端口号</strong>，每个需要访问网络的应用程序需要绑定不同的端口号，所以通过端口号UDP就能把数据包发给指定的应用程序；</p><p>总结就是：</p><p><strong>IP通过IP地址把数据包发送给指定的电脑，而UDP通过端口号把数据包分发给正确的程序</strong></p><p><img src="https://static001.geekbang.org/resource/image/3e/ea/3edb673a43f23d84253c52124ce447ea.png" alt="img"></p><p>UDP的传输速度很快，一般应用于在线视频，互动游戏等领域，但是，udp不能保证数据的可靠传输，对于错误的数据包，不会提供重传机制，而是选择直接丢弃，也没有确认机制。</p><p>为了解决这个问题，我们引入了TCP</p><p><strong>3.TCP：把数据完整地送达应用程序</strong></p><p>TCP协议是一种面向连接地，可靠的，基于字节流地传输层通信协议，提供超时重传和确认机制，还提供了数据包排序机制</p><p>TCP头包含了目标端口，本机端口，用于排序地序列号，便于接收端通过序号来重排数据包</p><p><img src="https://static001.geekbang.org/resource/image/94/32/943ac29f7d5b45a8861b0cde5da99032.png" alt="img"></p><p><strong>一个完整地TCP连接过程</strong>：</p><p><img src="https://static001.geekbang.org/resource/image/44/44/440ee50de56edc27c6b3c992b3a25844.png" alt="img"></p><p>三次握手建立连接</p><p>传输数据</p><p>四次挥手断开连接</p><p>一些疑问：</p><ol><li>浏览器可以同时打开多个页签，他们端口一样吗？如果一样，数据怎么知道去哪个页签？</li></ol><p>​	 端口一样的，网络进程知道每个tcp链接所对应的标签是那个，所以接收到数据后，会把数据分发给对应的渲染进程</p><ol start="2"><li><p>TCP传送数据时 浏览器端就做渲染处理了么？如果前面数据包丢了 后面数据包先来是要等么？类似的那种实时渲染怎么处理？针对数据包的顺序性？   </p><p>接收到http响应头中的content-type类型时就开始准备渲染进程了，响应体数据一旦接受到便开始做DOM解析了！基于http不用担心数据包丢失的问题，因为丢包和重传都是在tcp层解决的。http能保证数据按照顺序接收的（也就是说，从tcp到http的数据就已经是完整的了，即便是实时渲染，如果发生丢包也得在重传后才能开始渲染） </p></li><li><p>http 和 websocket都是属于应用层的协议吗？ </p><p>都是应用层协议，而且websocket名字取的比较有迷惑性，其实和socket完全不一样，可以把websocket看出是http的改造版本，增加了服务器向客户端主动发送消息的能力。 </p></li><li><p>关于 &quot;数据在传输的过程中有可能会丢失或者出错&quot;，丢失的数据包去哪里了？凭空消失了吗？出错的数据包又变成啥了？ 为什么会出错？ </p><p>比如网络波动，物理线路故障，设备故障，恶意程序拦截，网络阻塞等等</p></li></ol></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/tcp">tcp</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/blog/阅读日记1 chrome浏览器发展过程">阅读日记1 chrome浏览器发展过程</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-04-24T00:00:00.000Z" itemprop="datePublished">April 24, 2022</time> · <!-- -->8 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link avatar__photo"><img class="image_o0gy" src="https://avatars.githubusercontent.com/u/59378631?s=400&amp;u=5c50f7a8cf81217122611fb72484a0288d90a739&amp;v=4" alt="Nikki"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Nikki</span></a></div><small class="avatar__subtitle" itemprop="description">a coder</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>观察一个现象：</p><p>打开一个页面后，再打开chrome的任务管理器，发现启动了多个进程</p><p><img src="https://static001.geekbang.org/resource/image/ce/9e/ce7f8cfe212bec0f53360422e3b03a9e.png" alt="img"></p><p><strong>单线程</strong>执行任务是分步按顺序执行任务的；</p><p><strong>多线程</strong>可以同时处理多个任务，并行处理让性能大大提升</p><p>那么</p><p>线程和进程分别是什么？</p><ul><li>线程：不能单独存在，由进程来启动和管理</li><li>进程：一个进程就是一个程序的运行实例（在启动一个程序的时候，操作系统会为该程序创建一块内存，用来存放代码，运行中的数据和一个执行任务的主线程，我们把这样的一个运行环境叫进程）</li></ul><p>关系：线程是依附于进程的，而进程中使用多线程并行处理能提升运算效率</p><ul><li>进程中的任意线程执行出错，都会导致整个进程的崩溃</li><li>线程之间共享进程中的数据</li><li>当一个进程关闭之后，操作系统会回收进程所占用的内存</li><li>进程之间的内容相互隔离</li></ul><p>从前：<strong>单进程浏览器时代</strong></p><p>指的是浏览器的所有功能模块都是运行在同一个进程里</p><p><img src="https://static001.geekbang.org/resource/image/6d/ca/6ddad2419b049b0eb2a8036f3dfff1ca.png" alt="img"></p><p>单进程浏览器会导致浏览器不稳定（一个插件的崩溃会导致进程崩溃），不流畅（一个时刻只能有一个模块可以执行，假如运行的是无限循环脚本，将独占线程持续卡顿），不安全（恶意插件带来安全性问题）</p><p>现在：<strong>多进程浏览器时代</strong></p><p><img src="https://static001.geekbang.org/resource/image/cd/60/cdc9215e6c6377fc965b7fac8c3ec960.png" alt="img"></p><p>chrome的页面是运行在单独的渲染进程中的，同时页面里的插件也是运行在单独的插件进程之中，而进程之间是通过IPC机制进行通信</p><ul><li>解决了不稳定的问题：进程相互隔离，一个页面或插件崩溃只会影响到当前的页面进程或插件进程</li><li>解决了不流畅的问题：js运行在渲染进程中，即使js阻塞了渲染进程，影响到的也仅仅是当前的渲染页面，其他页面的脚本是运行在自己的渲染进程中的</li><li>解决了安全问题：使用安全沙箱，相当于操作系统给进程上了一把锁，沙箱里的程序可以运行，但不能在硬盘上写入和读取任何数据。chrome把插件进程和渲染进程都锁在了沙箱里面</li></ul><p><strong>最新的浏览器架构</strong></p><p><img src="https://static001.geekbang.org/resource/image/b6/fc/b61cab529fa31301bde290813b4587fc.png" alt="img"></p><ul><li>浏览器进程：负责界面显示，用户交互，子进程管理，同时提供存储等功能</li><li>渲染进程：核心任务是将 HTML、CSS 和 JavaScript 转换为用户可以与之交互的网页，排版引擎 Blink 和 JavaScript 引擎 V8 都是运行在该进程中，默认情况下，Chrome 会为每个 Tab 标签创建一个渲染进程。出于安全考虑，渲染进程都是运行在沙箱模式下</li><li>GPU进程：最初是为了实现3D css效果，后来chrome的ui界面都选择采用GPU绘制</li><li>网络进程：负责页面的网络资源加载</li><li>插件进程：主要是负责插件的运行，因插件易崩溃，所以需要通过插件进程来隔离，以保证插件进程崩溃不会对浏览器和页面造成影响。</li></ul><p>再回顾一下开始的现象，打开一个页面，却有4个进程。这是因为打开 1 个页面至少需要 1 个网络进程、1 个浏览器进程、1 个 GPU 进程以及 1 个渲染进程，共 4 个；如果打开的页面有运行插件的话，还需要再加上 1 个插件进程。</p><p>多进程浏览器缺点：</p><ul><li>更高的资源占用</li><li>更复杂的体系架构</li></ul><p>正在探索的未来浏览器：<strong>面向服务的架构</strong>（SOA）</p><p>原来的各种模块会被重构成独立的服务（Service），每个服务（Service）都可以在独立的进程中运行，访问服务（Service）必须使用定义好的接口，通过 IPC 来通信，从而构建一个更内聚、松耦合、易于维护和扩展的系统，更好实现 Chrome 简单、稳定、高速、安全的目标。</p><p><img src="https://static001.geekbang.org/resource/image/32/2a/329658fe821252db47b0964037a1de2a.png" alt="img"></p><p>一些小疑问：</p><p>即使是如今的多进程架构，偶尔还是会碰到一些由于单个页面卡死最终崩溃导致所有页面崩溃的情况，这是什么原因呢？</p><p>chrome的默认策略是每个标签对应一个渲染进程，但是如果从一个页面打开了新页面，而新页面和当前页面属于同一站点时，那么新页面会复用父页面的渲染进程</p><p>同一站点：根域名，协议相同，端口不同或者相同的网站</p><p>为什么要让他们跑在一个进程里面呢？</p><p>因为在一个渲染进程里面，他们就会共享JS的执行环境，也就是说A页面可以直接在B页面中执行脚本。(A,B站点进行通信传输数据)因为是同一家的站点，所以是有这个需求的</p><p>A页面可以直接在B页面中执行脚本是什么意思？</p><p>例如在本页面(简称B)左上角有一个“立即订阅”按钮，点开可以跳转到新页面(简称A)，在新页面A打开控制台，可以使用window.opener拿到B页面的window数据，同样使用window.opener.location.href或者其他API控制B页面跳转或操作其它window上的东西 这种跳转有点不安全，如果是a标签，可以通过</p><div class="codeBlockContainer_I0IT language-html theme-code-block"><div class="codeBlockContent_wNvx html"><pre tabindex="0" class="prism-code language-html codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">a</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">href</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag attr-value" style="color:#e3116c">/index</span><span class="token tag attr-value punctuation" style="color:#393A34">&#x27;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">rel</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value" style="color:#e3116c">noopener</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">链接</span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">a</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>来实现跳转，新页面就拿不到window.opener了</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/浏览器">浏览器</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/blog/剑指offer树相关算法题">剑指offer树相关算法题</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-04-23T00:00:00.000Z" itemprop="datePublished">April 23, 2022</time> · <!-- -->7 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link avatar__photo"><img class="image_o0gy" src="https://avatars.githubusercontent.com/u/59378631?s=400&amp;u=5c50f7a8cf81217122611fb72484a0288d90a739&amp;v=4" alt="Nikki"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Nikki</span></a></div><small class="avatar__subtitle" itemprop="description">a coder</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>深入理解前中后序</p><div class="codeBlockContainer_I0IT language-js theme-code-block"><div class="codeBlockContent_wNvx js"><pre tabindex="0" class="prism-code language-js codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">traverse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter maybe-class-name">TreeNode</span><span class="token parameter"> root</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//前序位置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">traverse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">left</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//中序位置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">traverse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">right</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//后序位置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>把代码写在不同的位置，代码执行时机也不同</p><p><img alt="image-20220320110511144" src="/assets/images/image-20220320110511144-940240acdff6a71bef54ad6749c3a7a9.png" width="639" height="362"></p><p>前中后序是遍历二叉树过程中处理每一个节点的三个特殊时间点：</p><ul><li><p>前序位置的代码在刚刚进入一个二叉树结点的时候执行</p></li><li><p>后序位置的代码在将要离开一个二叉树节点的时候执行</p></li><li><p>中序遍历的代码在一个二叉树节点左子树都遍历完，即将开始遍历右子树的时候执行</p></li></ul><p><img alt="image-20220320110854664" src="/assets/images/image-20220320110854664-2fc2cccc1620777b024b0f2012a513d9.png" width="417" height="556"></p><p>每一个节点都有唯一属于自己的前中后序位置</p><p><strong>二叉树的所有问题，就是让你在前中后序位置注入巧妙的代码逻辑，去达到自己的目的</strong></p><p>你只需要思考每一个节点应该做什么，其他的不用你管，抛给二叉树遍历框架，递归会对所有节点做相同的操作。</p><p>二叉树题目的递归解法可以分两类思路：</p><ul><li><p>第一类是遍历一遍二叉树得出答案(回溯算法框架)</p></li><li><p>第二类是通过分解问题计算出答案(动态规划框架)</p></li></ul><p>一旦发现题目与子树有关，那大概率要给函数设置合理的定义和返回值，在后序位置写代码</p><p>遇到一道二叉树的题目时的通用思考过程是：<strong>是否可以通过遍历一遍二叉树得到答案？如果不能的话，是否可以定义一个递归函数，通过子问题（子树）的答案推导出原问题的答案? 如果需要设计到子树信息, 建议使用后续遍历.</strong></p><h5 class="anchor anchorWithStickyNavbar_mojV" id="jz55-二叉树的深度返回左右子树最大深度根结点">jz55 二叉树的深度：返回左右子树最大深度+根结点<a class="hash-link" href="#jz55-二叉树的深度返回左右子树最大深度根结点" title="Direct link to heading">​</a></h5><div class="codeBlockContainer_I0IT language-js theme-code-block"><div class="codeBlockContent_wNvx js"><pre tabindex="0" class="prism-code language-js codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function maybe-class-name" style="color:#d73a49">TreeDepth</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">pRoot</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">pRoot</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> leftMax </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">TreeDept</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pRoot</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">left</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> rightMax </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">TreeDept</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pRoot</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">right</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//后序遍历位置，此时已经遍历完左右子树，获取了他们的深度，准备离开</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//此时记录下当前结点左右子树的最大深度</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> max </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">max</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">leftMax</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">rightMax</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//返回左右子树最大深度+根结点</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> max</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h5 class="anchor anchorWithStickyNavbar_mojV" id="jz77-按之字形打印二叉树设置队列queue用while控制深度for控制每层个数">jz77 按之字形打印二叉树：设置队列queue，用while控制深度，for控制每层个数<a class="hash-link" href="#jz77-按之字形打印二叉树设置队列queue用while控制深度for控制每层个数" title="Direct link to heading">​</a></h5><p>通过遍历的方式求解，想清楚在哪个位置做哪些事</p><div class="codeBlockContainer_I0IT language-js theme-code-block"><div class="codeBlockContent_wNvx js"><pre tabindex="0" class="prism-code language-js codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">root</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> queue </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> res </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> n </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">root</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">root</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//while控制层</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">while</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token operator" style="color:#393A34">!=</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> len </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> temp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//for循环控制每层的个数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">i</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">len</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">shift</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            temp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">val</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">left</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">left</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">right</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                queue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">right</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        n</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">n</span><span class="token operator" style="color:#393A34">%</span><span class="token number" style="color:#36acaa">2</span><span class="token operator" style="color:#393A34">==</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">temp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">reverse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">temp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h5 class="anchor anchorWithStickyNavbar_mojV" id="jz54-二叉搜索树的第k个结点中序遍历后返回第k-1位置的值">jz54 二叉搜索树的第k个结点:中序遍历后返回第<!-- -->[k-1]<!-- -->位置的值<a class="hash-link" href="#jz54-二叉搜索树的第k个结点中序遍历后返回第k-1位置的值" title="Direct link to heading">​</a></h5><p>找出二叉搜索树中第k小的结点</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="jz27-重建二叉树分解子问题先找出一个子树的左子树右子树再让递归帮你找出每个子树的左子树和右子树">jz27 重建二叉树：分解子问题，先找出一个子树的左子树右子树，再让递归帮你找出每个子树的左子树和右子树<a class="hash-link" href="#jz27-重建二叉树分解子问题先找出一个子树的左子树右子树再让递归帮你找出每个子树的左子树和右子树" title="Direct link to heading">​</a></h5><p>给出二叉树的前序遍历序列和中序遍历序列，然后进行二叉树的重建</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="jz26-树的子结构先判断b是不是a的一颗子树的子树再让递归帮我们判断b是不是a的其他子树的子树">jz26 树的子结构:先判断B是不是A的一颗子树的子树，再让递归帮我们判断B是不是A的其他子树的子树<a class="hash-link" href="#jz26-树的子结构先判断b是不是a的一颗子树的子树再让递归帮我们判断b是不是a的其他子树的子树" title="Direct link to heading">​</a></h5><p>判断B是不是A的子结构</p><div class="codeBlockContainer_I0IT language-js theme-code-block"><div class="codeBlockContent_wNvx js"><pre tabindex="0" class="prism-code language-js codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//当A,B的头节点不一样时，判断A的左子树里有没有B，A的右子树里有没有B</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">isSubTree</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter constant" style="color:#36acaa">A</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter constant" style="color:#36acaa">B</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">A</span><span class="token operator" style="color:#393A34">==</span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token operator" style="color:#393A34">||</span><span class="token constant" style="color:#36acaa">B</span><span class="token operator" style="color:#393A34">==</span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">isSubTree</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">A</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">left</span><span class="token punctuation" style="color:#393A34">,</span><span class="token constant" style="color:#36acaa">B</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">||</span><span class="token function" style="color:#d73a49">isSub</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">A</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">right</span><span class="token punctuation" style="color:#393A34">,</span><span class="token constant" style="color:#36acaa">B</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">||</span><span class="token function" style="color:#d73a49">isSameTree</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">A</span><span class="token punctuation" style="color:#393A34">,</span><span class="token constant" style="color:#36acaa">B</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//当A,B头节点一样时，判断B是否为A的子树</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">isSameTree</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter constant" style="color:#36acaa">A</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter constant" style="color:#36acaa">B</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//如果此时B遍历完了，且之前都一样时，说明B是A的子树</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">B</span><span class="token operator" style="color:#393A34">==</span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//如果此时A遍历完了，B还有为遍历的，说明B不是A的子树</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">A</span><span class="token operator" style="color:#393A34">==</span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//此时A，B都未遍历完，比较A，B此时指向结点的值是否相同</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">A</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">val</span><span class="token operator" style="color:#393A34">!==</span><span class="token constant" style="color:#36acaa">B</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">val</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//让递归帮我们遍历他的左子树和右子树</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">isSameTree</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">A</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">left</span><span class="token punctuation" style="color:#393A34">,</span><span class="token constant" style="color:#36acaa">B</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">left</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token function" style="color:#d73a49">isSameTree</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">A</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">right</span><span class="token punctuation" style="color:#393A34">,</span><span class="token constant" style="color:#36acaa">B</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">right</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h5 class="anchor anchorWithStickyNavbar_mojV" id="jz27-二叉树的镜像反转一颗子树让递归帮我们反转剩下的子树">jz27 二叉树的镜像：反转一颗子树，让递归帮我们反转剩下的子树<a class="hash-link" href="#jz27-二叉树的镜像反转一颗子树让递归帮我们反转剩下的子树" title="Direct link to heading">​</a></h5><div class="codeBlockContainer_I0IT language-js theme-code-block"><div class="codeBlockContent_wNvx js"><pre tabindex="0" class="prism-code language-js codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">reverse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter constant" style="color:#36acaa">A</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">A</span><span class="token operator" style="color:#393A34">==</span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">A</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">left</span><span class="token punctuation" style="color:#393A34">,</span><span class="token constant" style="color:#36acaa">A</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">right</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token constant" style="color:#36acaa">A</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">right</span><span class="token punctuation" style="color:#393A34">,</span><span class="token constant" style="color:#36acaa">A</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">left</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">reverse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">A</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">left</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">reverse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">A</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">right</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">A</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h5 class="anchor anchorWithStickyNavbar_mojV" id="jz33-二叉搜索树的后序遍历序列先判断一棵子树的结果是否为后序遍历序列再让递归帮我们判断其他子树">jz33 二叉搜索树的后序遍历序列：先判断一棵子树的结果是否为后序遍历序列，再让递归帮我们判断其他子树<a class="hash-link" href="#jz33-二叉搜索树的后序遍历序列先判断一棵子树的结果是否为后序遍历序列再让递归帮我们判断其他子树" title="Direct link to heading">​</a></h5><p>判断输入的整数数组是否为二叉搜索树的后序遍历结果</p><p>判断子树结果是否为后序遍历序列的方法：后序遍历---左右根，根在最后，二叉搜索树---左子树所有结点都比根小，右子树所有结点都比根大，问题的关键点是找到右子树开头的位置,也就是第一个比根大的位置</p><div class="codeBlockContainer_I0IT language-js theme-code-block"><div class="codeBlockContent_wNvx js"><pre tabindex="0" class="prism-code language-js codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">verifySequenceOfBTS</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">sequence</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sequence</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token operator" style="color:#393A34">==</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">verify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sequence</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">verify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">sequence</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> len  </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sequnce</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> root </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sequence</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">length</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">i</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">len</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sequence</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">root</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">break</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//看看右子树后的数是否都比root大，大则返回true，否则为false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sequence</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">slice</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">len</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">every</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token parameter">x</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> x</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">root</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//如果是true递归左右子树</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">verify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sequence</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">slice</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token function" style="color:#d73a49">verify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sequeue</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">slice</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">len</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/算法">算法</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/blog/VueRouter">VueRouter</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-04-22T00:00:00.000Z" itemprop="datePublished">April 22, 2022</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link avatar__photo"><img class="image_o0gy" src="https://avatars.githubusercontent.com/u/59378631?s=400&amp;u=5c50f7a8cf81217122611fb72484a0288d90a739&amp;v=4" alt="Nikki"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Nikki</span></a></div><small class="avatar__subtitle" itemprop="description">a coder</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>每有一个路由的嵌套，就要有一个router-view的嵌套</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="路由守卫">路由守卫<a class="hash-link" href="#路由守卫" title="Direct link to heading">​</a></h4><p>路由导航过程中有若干个生命周期钩子，可以在这里实现逻辑控制</p><ul><li><p>全局守卫，router.js</p><div class="codeBlockContainer_I0IT language-js theme-code-block"><div class="codeBlockContent_wNvx js"><pre tabindex="0" class="prism-code language-js codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//路由配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">path</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;/about&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;about&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">meta</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">auth</span><span class="token operator" style="color:#393A34">:</span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token comment" style="color:#999988;font-style:italic">//需要认证</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function-variable function" style="color:#d73a49">component</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">import</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//守卫</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">router</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">beforeEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">to</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter keyword module" style="color:#00009f">from</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter">next</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//需要认证且没有登录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">to</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">meta</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">auth</span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> localToken</span><span class="token operator" style="color:#393A34">==</span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">登录成功</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">//存一个token</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            localToken </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;21312&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;/&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token comment" style="color:#999988;font-style:italic">//不需认证</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>路由独享守卫</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">//路由配置里</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">beforEnter(to,from,next) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>组件里的的守卫</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">export default {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    beforeRouteEnter(to,from,next) {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    beforeRouteUpdate(to,from,next) {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="vue-router拓展">vue-router拓展<a class="hash-link" href="#vue-router拓展" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_mojV" id="动态路由">动态路由<a class="hash-link" href="#动态路由" title="Direct link to heading">​</a></h4><p>利用＄router.addRoutes()可以实现动态路由添加，常用于用户权限控制</p><div class="codeBlockContainer_I0IT language-js theme-code-block"><div class="codeBlockContent_wNvx js"><pre tabindex="0" class="prism-code language-js codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//router.js</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//返回数据可能是这样的</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">path</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;/&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;home&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">component</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;Home&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//异步获取路由,对应路由信息由后台传过来</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">api</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getRoutes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">routes</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> routeConfig </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> routes</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">route</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mapComponent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">route</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    router</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addRoutes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">routeConfig</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//映射关系</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> compMap </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">&#x27;Home&#x27;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">import</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;./view/Home.vue&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//递归替换</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mapComponent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">route</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    route</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">component</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> compMap</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">route</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">component</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">route</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">children</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        route</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">children</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> route</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">children</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">child</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mapComponent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">child</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> route</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="面包屑">面包屑<a class="hash-link" href="#面包屑" title="Direct link to heading">​</a></h4><p>利用$route.matched可得到路由匹配数组，按顺序解析可得路由层级关系</p><div class="codeBlockContainer_I0IT language-vue theme-code-block"><div class="codeBlockContent_wNvx vue"><pre tabindex="0" class="prism-code language-vue codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">//Brandcrumb.vue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">watch:{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $route: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            handler(route) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //[{name:&#x27;home&#x27;,path:&#x27;/&#x27;},{name:&#x27;list&#x27;,path:&#x27;/list&#x27;}]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        console.log(this.$route.matched)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //[&#x27;home&#x27;,&#x27;list&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.crumbData = this.$route.matched.map(m =&gt; m.name)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    immediate:true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/vue">Vue</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/page/2"><div class="pagination-nav__label">Older Entries</div></a></div></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs">Notes</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023</div></div></div></footer></div>
<script src="/assets/js/runtime~main.852293d6.js"></script>
<script src="/assets/js/main.026a2937.js"></script>
</body>
</html>