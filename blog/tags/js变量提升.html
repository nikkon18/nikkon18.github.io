<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Nikki&#39;s Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Nikki&#39;s Blog Atom Feed"><title data-react-helmet="true">3 posts tagged with &quot;js变量提升&quot; | Nikki&#x27;s Blog</title><meta data-react-helmet="true" property="og:title" content="3 posts tagged with &quot;js变量提升&quot; | Nikki&#x27;s Blog"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://nikkon18.github.io//blog/tags/js变量提升"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="blog_tags_posts"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://nikkon18.github.io//blog/tags/js变量提升"><link data-react-helmet="true" rel="alternate" href="https://nikkon18.github.io//blog/tags/js变量提升" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://nikkon18.github.io//blog/tags/js变量提升" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.9c11c536.css">
<link rel="preload" href="/assets/js/runtime~main.852293d6.js" as="script">
<link rel="preload" href="/assets/js/main.026a2937.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Nikki&#x27;s Blog</b></a><a class="navbar__item navbar__link" href="/docs/Supervised Machine Learning/Overview of Machine learning">Notes</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">🌜</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">🌞</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-tags-post-list-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_a9qW thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_uKok margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Kvuv"><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/阅读日记8 块级作用域：var缺陷以及为什么要引入let和const">阅读日记8 块级作用域：var缺陷以及为什么要引入let和const</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/阅读日记7 调用栈：为什么js代码会出现栈溢出">阅读日记7 调用栈：为什么js代码会出现栈溢出</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/阅读日记6 变量提升：js代码是按顺序执行吗？">阅读日记6 变量提升：js代码是按顺序执行吗？</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/阅读日记5 浏览器的渲染流程">阅读日记5 浏览器的渲染流程</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/阅读日记4 从输入URL到页面展示，这中间发生了什么">阅读日记4 从输入URL到页面展示，这中间发生了什么</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/阅读笔记3 http请求流程">阅读笔记3 http请求流程</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/阅读日记2 tcp协议是如何工作的">阅读日记2 tcp协议是如何工作的</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/阅读日记1 chrome浏览器发展过程">阅读日记1 chrome浏览器发展过程</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/剑指offer树相关算法题">剑指offer树相关算法题</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/VueRouter">VueRouter</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/团队中的git操作">团队中的git操作</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/Vue组件化设计">Vue组件化设计</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/前端网络安全">前端网络安全</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/Webpack的使用">Webpack的使用</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/css基本布局">css基本布局</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/this指向问题">this指向问题</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/字符串的常用方法">字符串的常用方法</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/数组的常用方法">数组的常用方法</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/js数据类型相关">js数据类型相关</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/执行上下文与变量提升">执行上下文与变量提升</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/异步编程的解决方案">异步编程的解决方案</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/事件模型">事件模型</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/深拷贝与浅拷贝">深拷贝与浅拷贝</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/闭包">闭包</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/js数据结构">js数据结构</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/express的基本使用">express的基本使用</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>3 posts tagged with &quot;js变量提升&quot;</h1><a href="/blog/tags">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/blog/阅读日记8 块级作用域：var缺陷以及为什么要引入let和const">阅读日记8 块级作用域：var缺陷以及为什么要引入let和const</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-05-13T00:00:00.000Z" itemprop="datePublished">May 13, 2022</time> · <!-- -->7 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link avatar__photo"><img class="image_o0gy" src="https://avatars.githubusercontent.com/u/59378631?s=400&amp;u=5c50f7a8cf81217122611fb72484a0288d90a739&amp;v=4" alt="Nikki"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Nikki</span></a></div><small class="avatar__subtitle" itemprop="description">a coder</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><strong>作用域</strong>是指在程序中定义变量的区域，该位置决定了变量的生命周期。通俗来说，作用域就是<strong>变量与函数的可访问范围</strong>，即作用域控制着变量的函数的可见性和生命周期。</p><p>ES6之前的作用域：</p><ul><li>全局作用域</li><li>函数作用域</li></ul><p>ES6新增：</p><ul><li>块级作用域</li></ul><p>简单来讲，如果一种语言支持块级作用域，那么其代码块内部定义的变量在代码块外部是访问不到的，并且等该代码块中的代码执行完成之后，代码块中定义的变量会被销毁。</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="没有块级作用域的坏处">没有块级作用域的坏处：<a class="hash-link" href="#没有块级作用域的坏处" title="Direct link to heading">​</a></h5><p>导致了函数中的变量无论是在哪里声明的，在编译阶段都会被提取到执行上下文的变量环境中，所以这些变量在整个函数体内部的任何地方都是能被访问的，这也就是<strong>变量提升</strong></p><h5 class="anchor anchorWithStickyNavbar_mojV" id="变量提升带来的问题">变量提升带来的问题：<a class="hash-link" href="#变量提升带来的问题" title="Direct link to heading">​</a></h5><p>1.变量容易在不被察觉的情况下被覆盖掉</p><p>2.本应销毁的变量没有被销毁（例子：for循环+var声明变量）</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="es6如何解决变量提升的问题">ES6如何解决变量提升的问题：<a class="hash-link" href="#es6如何解决变量提升的问题" title="Direct link to heading">​</a></h5><p>引入let和const关键字</p><p>两者区别：使用let关键字声明的变量是可以被改变的，而使用const声明的变量值是不可以被改变的</p><p>这两个关键字支持块级作用域，在编译阶段，js引擎并不会把块中通过let和const声明的变量存放到变量环境中，这也就意味着<strong>在块中通过let和const声明的变量，并不会提升到全函数可见</strong></p><h5 class="anchor anchorWithStickyNavbar_mojV" id="js是如何支持块级作用域的">js是如何支持块级作用域的？<a class="hash-link" href="#js是如何支持块级作用域的" title="Direct link to heading">​</a></h5><p>js引擎是通过变量环境实现函数级作用域的</p><div class="codeBlockContainer_I0IT language-js theme-code-block"><div class="codeBlockContent_wNvx js"><pre tabindex="0" class="prism-code language-js codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">foo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> b </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> b </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> c </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> d </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">d</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">foo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>以上代码的执行流程：</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="第一步编译并创建执行上下文">第一步，编译并创建执行上下文<a class="hash-link" href="#第一步编译并创建执行上下文" title="Direct link to heading">​</a></h5><p>以下是执行时foo函数的执行上下文</p><p><img src="https://static001.geekbang.org/resource/image/f9/67/f9f67f2f53437218baef9dc724bd4c67.png" alt="img"></p><p>通过上图，我们可以得出以下结论：</p><ul><li>函数内部通过 var 声明的变量，在编译阶段全都被存放到<strong>变量环境</strong>里面了。</li><li>通过 let 声明的变量，在编译阶段会被存放到<strong>词法环境</strong>（Lexical Environment）中。</li><li>在函数的<strong>作用域块内部</strong>，通过 let 声明的变量并<strong>没有</strong>被存放到词法环境中。</li></ul><h5 class="anchor anchorWithStickyNavbar_mojV" id="第二步继续执行代码">第二步，继续执行代码<a class="hash-link" href="#第二步继续执行代码" title="Direct link to heading">​</a></h5><p>当执行到代码块里面时，变量环境中 a 的值已经被设置成了 1，词法环境中 b 的值已经被设置成了 2，这时候函数的执行上下文就如下图所示：</p><p><img src="https://static001.geekbang.org/resource/image/7e/fa/7e0f7bc362e0dea21d27dc5fb08d06fa.png" alt="img"></p><p>在词法环境内部，维护了一个小型栈结构，栈底是函数最外层的变量，进入一个作用域块后，就会把该作用域块内部的变量压到栈顶；当作用域执行完成之后，该作用域的信息就会从栈顶弹出，这就是词法环境的结构。需要注意下，我这里所讲的变量是指通过 let 或者 const 声明的变量。</p><p>查找变量a的过程：先找词法环境，再找变量环境</p><p><img src="https://static001.geekbang.org/resource/image/06/08/06c06a756632acb12aa97b3be57bb908.png" alt="img"></p><p>当作用域块执行结束之后，其内部定义的变量就会从词法环境的栈顶弹出，最终执行上下文如下图所示：</p><p><img src="https://static001.geekbang.org/resource/image/d4/28/d4f99640d62feba4202aa072f6369d28.png" alt="img"></p><p>块级作用域是通过词法环境的栈结构来实现的，而变量提升是通过变量环境来实现，通过这两种的结合，js引擎就同时支持了变量提升和块级作用域了。</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="思考">思考<a class="hash-link" href="#思考" title="Direct link to heading">​</a></h5><p>以下代码的打印结果：</p><div class="codeBlockContainer_I0IT language-js theme-code-block"><div class="codeBlockContent_wNvx js"><pre tabindex="0" class="prism-code language-js codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> myname</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;极客时间&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">myname</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> myname</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;极客邦&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>结果：</p><p>VM6277:3 Uncaught ReferenceError: Cannot access &#x27;myname&#x27; before initialization</p><p>原因：</p><p>在块级作用域内，let声明的变量被提升，但变量只是创建被提升，初始化并没有被提升，在初始化之前使用变量，就会形成暂时性死区</p><p>拓展：</p><p>var的创建和初始化被提升，赋值不会被提升。</p><p>let的创建被提升，初始化和赋值不会被提升。</p><p>function的创建、初始化和赋值均会被提升。</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="变量提升和暂时性死区的区别">变量提升和暂时性死区的区别：<a class="hash-link" href="#变量提升和暂时性死区的区别" title="Direct link to heading">​</a></h4><p>变量提升：编译时把var声明的变量放到变量环境，进入块级作用域是不编译的，所以不存在变量提升</p><p>暂时性死区：在初始化前使用变量，会形成暂时性死区，用var声明的变量会在创建是就进行初始化undefined，而let和cont声明的变量初始化时会被置为uninitialized标志位，在没有执行到赋值行时便对其进行访问，就会报暂时性死区错误</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/js变量提升">js变量提升</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about 阅读日记8 块级作用域：var缺陷以及为什么要引入let和const" href="/blog/阅读日记8 块级作用域：var缺陷以及为什么要引入let和const"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/blog/阅读日记7 调用栈：为什么js代码会出现栈溢出">阅读日记7 调用栈：为什么js代码会出现栈溢出</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-05-10T00:00:00.000Z" itemprop="datePublished">May 10, 2022</time> · <!-- -->5 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link avatar__photo"><img class="image_o0gy" src="https://avatars.githubusercontent.com/u/59378631?s=400&amp;u=5c50f7a8cf81217122611fb72484a0288d90a739&amp;v=4" alt="Nikki"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Nikki</span></a></div><small class="avatar__subtitle" itemprop="description">a coder</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><strong>执行上下文</strong>分三种：</p><ul><li>全局执行上下文</li><li>函数执行上下文</li><li>eval函数执行上下文</li></ul><p><strong>调用栈就是用来管理函数调用关系的一种数据结构</strong></p><p><strong>js引擎通过栈这种后进先出的数据结构来管理执行上下文</strong></p><p><img src="https://static001.geekbang.org/resource/image/5e/05/5e2bb65019053abfd5e7710e41d1b405.png" alt="img"></p><p>在执行上下文创建好后，js引擎会将执行上下文压入栈中，通常把这种用来管理执行上下文的栈称为<strong>执行上下文栈</strong>，又称<strong>调用栈</strong></p><h4 class="anchor anchorWithStickyNavbar_mojV" id="从一个例子看调用栈是如何工作的">从一个例子看调用栈是如何工作的？<a class="hash-link" href="#从一个例子看调用栈是如何工作的" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT language-js theme-code-block"><div class="codeBlockContent_wNvx js"><pre tabindex="0" class="prism-code language-js codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">b</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter">c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> b</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">addAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">b</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter">c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> d </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain">  a</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">result</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">addAll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h5 class="anchor anchorWithStickyNavbar_mojV" id="第一步创建全局执行上下文并将其压入栈底">第一步，创建全局执行上下文，并将其压入栈底<a class="hash-link" href="#第一步创建全局执行上下文并将其压入栈底" title="Direct link to heading">​</a></h5><p><img src="https://static001.geekbang.org/resource/image/a5/1d/a5d7ec1f8f296412acc045835b85431d.png" alt="img"></p><p>全局执行上下文压入到调用栈后，js引擎便开始执行全局代码。首先会执行a=2的赋值操作，然后会将全局上下文变量环境中a的值设置为2，设置后如下图</p><p><img src="https://static001.geekbang.org/resource/image/1d/1d/1d50269dbc5b4c69f83662ecdd977b1d.png" alt="img"></p><h5 class="anchor anchorWithStickyNavbar_mojV" id="第二步调用addall函数">第二步，调用addAll函数。<a class="hash-link" href="#第二步调用addall函数" title="Direct link to heading">​</a></h5><p>调用该函数时，js引擎会编译该函数，并为其创建一个执行上下文，最后将该函数的执行上下文压入栈中，如下图</p><p><img src="https://static001.geekbang.org/resource/image/7d/52/7d6c4c45db4ef9b900678092e6c53652.png" alt="img"></p><p>创建完addAll函数的执行上下文，便进入了函数代码的执行阶段，先执行的是d=10的赋值操作，执行语句会将addAll函数执行上下文中的d由undefined变成了10.</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="第三步执行到add函数调用语句时同样会为其创建执行上下文并将其压入调用栈">第三步，执行到add函数调用语句时，同样会为其创建执行上下文，并将其压入调用栈<a class="hash-link" href="#第三步执行到add函数调用语句时同样会为其创建执行上下文并将其压入调用栈" title="Direct link to heading">​</a></h5><p><img src="https://static001.geekbang.org/resource/image/cc/37/ccfe41d906040031a7df1e4f1bce5837.png" alt="img"></p><p>当add函数返回时，该函数的执行上下文就会从栈顶弹出，并将result的值设置为add函数的返回值，也就是9，如下图所示</p><p><img src="https://static001.geekbang.org/resource/image/03/96/03ca801a5372f941bf17d6088fee0f96.png" alt="img"></p><p>紧接着 addAll 执行最后一个相加操作后并返回，addAll 的执行上下文也会从栈顶部弹出，此时调用栈中就只剩下全局上下文了。最终如下图所示：</p><p><img src="https://static001.geekbang.org/resource/image/d0/7b/d0ac1d6e77735338fa97cc9a3f6c717b.png" alt="img"></p><p>至此，整个 JavaScript 流程执行结束了。</p><p>从上面可知：<strong>调用栈是js引擎追踪函数执行的一个机制</strong>，当一次有多个函数被调用时，通过调用栈就能够追踪到哪个函数正在被执行以及各函数之间的调用关系</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="开发中如何利用好调用栈">开发中如何利用好调用栈？<a class="hash-link" href="#开发中如何利用好调用栈" title="Direct link to heading">​</a></h4><p>1.打开“开发者工具”，点击“Source”标签，选择 JavaScript 代码的页面，然后在第 3 行加上断点，并刷新页面。你可以看到执行到 add 函数时，执行流程就暂停了，这时可以通过右边“call stack”来查看当前的调用栈的情况，如下图：</p><p><img src="https://static001.geekbang.org/resource/image/c0/a2/c0d303a289a535b87a6c445ba7f34fa2.png" alt="img"></p><p>2.使用console.trace()来输出当前的函数调用关系，比如在示例代码中的 add 函数里面加上了 console.trace()</p><p><img src="https://static001.geekbang.org/resource/image/ab/ce/abfba06cd23a7704a6eb148cff443ece.png" alt="img"></p><h4 class="anchor anchorWithStickyNavbar_mojV" id="栈溢出问题究竟指的是什么">栈溢出问题究竟指的是什么？<a class="hash-link" href="#栈溢出问题究竟指的是什么" title="Direct link to heading">​</a></h4><p>调用栈是有大小的，但入栈的执行上下文超过一定数目，js引擎就会报错，我们把这种错误叫做栈溢出。特别是在写递归代码的时候，很容易发生栈溢出。</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="如何解决">如何解决？<a class="hash-link" href="#如何解决" title="Direct link to heading">​</a></h5><p>可以使用一些方法来避免或者解决栈溢出的问题，比如把递归调用的形式改造成其他形式，或者使用加入定时器的方法来把当前任务拆分为其他很多小任务。</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/js变量提升">js变量提升</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about 阅读日记7 调用栈：为什么js代码会出现栈溢出" href="/blog/阅读日记7 调用栈：为什么js代码会出现栈溢出"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/blog/阅读日记6 变量提升：js代码是按顺序执行吗？">阅读日记6 变量提升：js代码是按顺序执行吗？</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-05-08T00:00:00.000Z" itemprop="datePublished">May 8, 2022</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link avatar__photo"><img class="image_o0gy" src="https://avatars.githubusercontent.com/u/59378631?s=400&amp;u=5c50f7a8cf81217122611fb72484a0288d90a739&amp;v=4" alt="Nikki"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Nikki</span></a></div><small class="avatar__subtitle" itemprop="description">a coder</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>1.在执行过程中，若使用了未声明的变量，那么js执行会报错</p><p>2.在一个变量定义之前使用它，不会出错，但是该变量的值为undefined，而不是定义时的值</p><p>3.在一个函数定义之前使用它，不会报错，且函数能正确执行</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="变量提升">变量提升<a class="hash-link" href="#变量提升" title="Direct link to heading">​</a></h4><p><strong>变量</strong></p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">var myname = &#x27;dym&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>相当于</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">var myname //声明</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">myname = &#x27;dym&#x27;//赋值</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><strong>函数</strong></p><p><img src="https://static001.geekbang.org/resource/image/61/77/611c09ab995b9b608d9c0db193266777.png" alt="img"></p><p>所谓的<strong>变量提升</strong>，是指在 JavaScript 代码执行过程中，JavaScript 引擎把变量的声明部分和函数的声明部分提升到代码开头的“行为”。变量被提升后，会给变量设置默认值，这个默认值就是我们熟悉的 undefined。</p><p><img src="https://static001.geekbang.org/resource/image/ce/d5/cefe564dbff729e735a834fd9e3bd0d5.png" alt="img"></p><h4 class="anchor anchorWithStickyNavbar_mojV" id="js代码执行流程">js代码执行流程<a class="hash-link" href="#js代码执行流程" title="Direct link to heading">​</a></h4><p><img src="https://static001.geekbang.org/resource/image/64/1e/649c6e3b5509ffd40e13ce9c91b3d91e.png" alt="img"></p><h5 class="anchor anchorWithStickyNavbar_mojV" id="1编译阶段">1.编译阶段<a class="hash-link" href="#1编译阶段" title="Direct link to heading">​</a></h5><p><img src="https://static001.geekbang.org/resource/image/06/13/0655d18ec347a95dfbf843969a921a13.png" alt="img"></p><p>编译后代码会生成两部分：<strong>执行上下文</strong>和<strong>可执行代码</strong></p><p><strong>执行上下文</strong>是 JavaScript 执行一段代码时的运行环境，比如调用一个函数，就会进入这个函数的执行上下文，确定该函数在执行期间用到的诸如 this、变量、对象以及函数等。</p><p>会将变量和函数的声明存放到变量环境中，若存在重复的变量或函数，第二个变量或函数会覆盖前一个</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="2执行阶段">2.执行阶段<a class="hash-link" href="#2执行阶段" title="Direct link to heading">​</a></h5><p>js引擎开始执行可执行代码，按照顺序一行一行地执行。当执行到对应地变量和函数时，js引擎便开始在变量环境对象中查找该函数。</p><p>一段代码如果定义了两个相同名字的函数，那么最终生效的是最后一个函数</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/js变量提升">js变量提升</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about 阅读日记6 变量提升：js代码是按顺序执行吗？" href="/blog/阅读日记6 变量提升：js代码是按顺序执行吗？"><b>Read More</b></a></div></footer></article></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs">Notes</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023</div></div></div></footer></div>
<script src="/assets/js/runtime~main.852293d6.js"></script>
<script src="/assets/js/main.026a2937.js"></script>
</body>
</html>